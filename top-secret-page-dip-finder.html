<html>
  <head>
    <link rel="stylesheet" href="styles.css">
    <script src="utilities.js"></script>
  </head>
  <body style="padding: 100px;">

    <h1>Uncle Liam's DipFinder</h1>

<form onsubmit="getTopMovers();return false;">
  <label for="candleIntervalSelector">Interval</label>
  <input id="candleIntervalSelector" value="1w" />
  
  <label for="timeframeSelector">Candles (max 1000)</label>
  <input id="timeframeSelector" value="1000" />
  
  <label for="timeTravelOffestSelector">Time travel</label>
  <input id="timeTravelOffestSelector" value="0" />

  <button>Puto</button>
</form>

    <script>
    	const getTopMovers = async () => {
    		// loadingSpinner.classList.add('spinner');
    		const candleCount = parseInt(timeframeSelector.value);
    		const candleInterval = candleIntervalSelector.value;
    		window.timeTravelOffset = parseInt(timeTravelOffestSelector.value);
    		await fetch('https://api.binance.com/api/v3/exchangeInfo').then(data => data.json()).then(async (i) => {
    			var usdtList = i.symbols.filter((p) => p.quoteAsset === "USDT" && p.status === "TRADING")
    			await Promise.all(usdtList.map((p) => {
    				return fetch(`https://api.binance.com/api/v3/klines?symbol=${p.symbol}&interval=${candleInterval}&limit=${candleCount + window.timeTravelOffset}`).then(data => data.json()).then(candles => ({pair: p, candles: candles.slice(0, candles.length - window.timeTravelOffset)})).catch(e => console.log(e.message))
    			})).then((values) => {
    				window.allCandles = values;
    				const withMultiplierValue = values.map(item => {
    					if(item.candles.length < candleCount) return;
    					if(item.pair.symbol === "FTTUSDT") return; // FTT has a huge year-long gap in candle data, I'm not sure why binance have allowed that
    					return {
    						...item,
    						//...getCandleComparison(item.candles)
    					}
    				}).filter(item => !!item);
    				
    			});
    		}).catch(e => console.log(e.message));
    		// loadingSpinner.classList.remove('spinner');
    		return "FINISHED";
    	}
    
    </script>
  </body>

</html>
